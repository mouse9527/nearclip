# 技术栈

## 技术栈表

| 类别 | 技术 | 版本 | 用途 | 理由 |
|------|------|------|------|------|
| **共享逻辑语言** | Rust | 1.75+ | 核心业务逻辑 | 内存安全、高性能、跨平台一致性、FFI 支持 |
| **数据序列化** | Protocol Buffers | 3.24+ | 跨平台数据格式 | 类型安全、高性能、版本兼容、代码生成 |
| Android 语言 | Kotlin | 1.9.20 | UI 和平台层 | 类型安全、与 Java 互操作、Google 官方支持 |
| Android 框架 | Jetpack Compose | 1.5.4 | 现代声明式 UI | 简化 UI 开发、状态管理、动画支持 |
| Mac 语言 | Swift | 5.9 | UI 和平台层 | 类型安全、性能优秀、Apple 生态系统原生支持 |
| Mac 框架 | SwiftUI | 5.0 | 声明式 UI 框架 | 现代、响应式、与 Swift 深度集成 |
| FFI 接口 | JNI (Android) | - | Kotlin ↔ Rust 通信 | 平台原生、成熟稳定、性能优化 |
| FFI 接口 | C ABI (Mac) | - | Swift ↔ Rust 通信 | 标准接口、跨语言兼容、系统集成 |
| UI 组件库 | 原生组件 | - | UI 实现 | 平台一致性、性能最优、系统集成度高 |
| 状态管理 | ViewModel + StateFlow | - | Android 状态管理 | 生命周期感知、响应式、架构一致性 |
| 通信协议 | BLE 协议 | 5.0+ | 设备间通信 | 低功耗、广泛支持、近场通信优化 |
| 数据库 | Room (Android) | 2.5.0 | 本地数据存储 | 类型安全、SQLite 抽象、迁移支持 |
| 缓存 | Core Data (Mac) | - | 本地数据存储 | Apple 生态原生、性能优化 |
| 文件存储 | SharedPreferences | - | 配置存储 | 简单键值对存储、平台原生 |
| 认证加密 | Rust Crypto | - | 设备配对验证 | 内存安全、算法实现可靠、跨平台一致 |
| 前端测试 | JUnit + Espresso | 4.13.2 | Android 测试 | 标准测试框架、UI 测试支持 |
| 后端测试 | XCTest | - | Mac 测试 | Apple 官方测试框架、集成度高 |
| Rust 测试 | Cargo Test | - | 共享逻辑测试 | 内置测试框架、性能基准测试、内存检查 |
| E2E 测试 | 自定义测试工具 | - | 跨设备测试 | 特定协议测试、设备模拟 |
| 构建工具 | Gradle (Android) | 8.0 | Android 构建系统 | 灵活性高、依赖管理、多模块支持 |
| 构建工具 | Cargo (Rust) | 1.75+ | Rust 构建系统 | 包管理、依赖管理、交叉编译支持 |
| 打包工具 | Xcode Build | - | Mac 构建 | Apple 官方、优化深度、签名集成 |
| FFI 生成 | cbindgen | - | C 头文件生成 | 自动生成 Rust C API、维护性好 |
| 协议生成 | protoc | 3.24+ | Protocol Buffers 编译器 | 多语言代码生成、类型安全 |
| IaC 工具 | - | - | 基础设施 | 本地应用无需基础设施即代码 |
| CI/CD | GitHub Actions | - | 自动化构建 | 集成度高、免费额度、跨平台支持 |
| 监控 | 自定义日志系统 | - | 应用监控 | 轻量级、隐私保护、本地存储 |
| 日志 | Rust log crate | - | 统一日志记录 | 跨平台一致性、结构化日志、性能优化 |
| CSS 框架 | - | - | 不适用 | 原生应用无需 CSS |

## 核心技术栈架构

### 多语言协作模式

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Android UI    │    │    Mac UI       │    │   Rust Core     │
│   (Kotlin)      │    │   (Swift)       │    │   (Business)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────┬───────────┴───────────────┬─────────┘
                     │           Protocol Buffers  │
                     └───────────────┬───────────┘
                                     │
                    ┌────────────────┴────────────────┐
                    │        BLE Communication       │
                    │      (Rust Implementation)     │
                    └─────────────────────────────────┘
```

### 技术选型优势

#### Rust 作为核心逻辑
- **内存安全**: 编译时保证内存安全，避免常见安全漏洞
- **性能**: 零成本抽象，接近 C/C++ 的性能
- **并发**: 内置并发安全，避免数据竞争
- **跨平台**: 一次编写，多平台编译
- **FFI**: 优秀的 FFI 支持，与多种语言无缝集成

#### Protocol Buffers 替代 JSON
- **类型安全**: 强类型定义，编译时检查
- **性能**: 二进制格式，比 JSON 更小更快
- **版本兼容**: 支持协议演化，向后兼容
- **代码生成**: 自动生成各语言代码，减少手工编码

#### FFI 集成策略
- **Android**: JNI 提供成熟的 Kotlin ↔ C/Rust 互操作
- **macOS**: C ABI 提供 Swift ↔ C/Rust 标准接口
- **统一接口**: 所有平台通过相同的 Rust API 获得一致行为
