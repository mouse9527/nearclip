# Story 1.1: 项目初始化与仓库结构设置

## Status
Ready for Review

## Story
**作为** 开发者，
**我希望** 建立 monorepo 项目结构，采用 src/platform/android、src/platform/mac、src/shared 的统一目录结构，
**以便** 能够统一管理项目代码、共享核心协议和配置开发工具链。

## Acceptance Criteria
1. 创建 monorepo 结构，包含 `src/platform/android`、`src/platform/mac` 和 `src/shared` 目录
2. 设置 Git 仓库，建立合理的 .gitignore 规则（包括 Rust target 目录等）
3. 配置基础的构建脚本和开发工具链（包括 Rust 工具链）
4. 建立 src/shared 目录结构用于存放 Protocol Buffers 定义和 Rust 共享逻辑
5. 创建项目 README 文档，包含项目概述和开发指南（包括 Rust 环境设置）

## Tasks / Subtasks
- [x] 创建基础 monorepo 目录结构 (AC: 1)
  - [x] 创建根目录下的主要子目录：src/platform/android、src/platform/mac、src/shared
  - [x] 在 src/shared 下创建 protocol/ 和 rust/ 子目录
  - [x] 在 src/platform/android 下创建 app/ 模块基础结构
  - [x] 在 src/platform/mac 下创建 NearClip 项目基础结构
- [x] 初始化 Git 仓库和配置 (AC: 2)
  - [x] 初始化 Git 仓库
  - [x] 创建适合多语言项目的 .gitignore 文件
  - [x] 添加 Rust target/、build/、*.class 等忽略规则
  - [x] 设置基础的 Git 配置
- [x] 配置构建脚本和工具链 (AC: 3)
  - [x] 创建 Android 项目的 build.gradle.kts 配置
  - [x] 创建 Mac 项目的 Package.swift 配置
  - [x] 在 scripts/ 目录下创建构建脚本：build-android.sh、build-mac.sh、build-rust.sh
  - [x] 配置 GitHub Actions CI/CD 工作流文件
- [x] 建立共享协议结构 (AC: 4)
  - [x] 在 src/shared/protocol/ 下创建基础协议文件模板
  - [x] 创建设备发现和配对的 .proto 文件
  - [x] 创建数据同步的 .proto 文件
  - [x] 创建错误处理的 .proto 文件
  - [x] 在 src/shared/rust/ 下创建 Rust 库项目结构
- [x] 创建项目文档 (AC: 5)
  - [x] 创建根目录 README.md 文件
  - [x] 包含项目概述和技术栈说明
  - [x] 创建开发指南文档
  - [x] 创建环境变量模板文件 .env.example
  - [x] 添加开源许可证文件 LICENSE

## Dev Notes

### 项目结构信息
根据统一项目结构文档 [Source: architecture/unified-project-structure.md]，项目采用以下结构：

```
nearclip/
├── src/
│   ├── platform/
│   │   ├── android/
│   │   └── mac/
│   └── shared/
│       ├── protocol/
│       └── rust/
├── docs/
├── scripts/
└── README.md
```

### 技术栈信息
[Source: architecture/tech-stack.md]
- **共享逻辑语言**: Rust 1.70+ (核心业务逻辑)
- **数据序列化**: Protocol Buffers 3.x (跨平台数据格式)
- Android: Kotlin 1.9.20 + Jetpack Compose 1.5.4
- Mac: Swift 5.9 + SwiftUI 5.0
- **FFI 接口**: JNI (Android) + C ABI (Mac)

### 高层次架构信息
[Source: architecture/high-level-architecture.md]
- **多层架构**: UI 层 → FFI 层 → Rust 逻辑层 → 协议层
- **跨语言集成**: Kotlin ↔ Rust ↔ Swift 通过 FFI
- **统一接口**: 所有平台通过相同的 Rust API 获得一致行为

### 关键技术组件
- **Protocol Buffers 处理器**: 统一的序列化/反序列化
- **BLE 通信引擎**: Rust 核心通信管理
- **安全与加密模块**: 设备配对验证、端到端加密
- **设备管理器**: 设备状态管理、连接状态跟踪

### Testing

#### 测试标准
[Source: architecture/testing-strategy.md]

**测试文件位置：**
- Android: `src/platform/android/app/src/test/`
- Mac: `src/platform/mac/NearClip/Tests/`
- Rust: `src/shared/rust/tests/`

**测试框架和模式：**
- Android: JUnit 4.13.2 + Espresso
- Mac: XCTest
- Rust: Cargo Test
- E2E: 自定义跨设备测试工具

**本故事特定测试要求：**
- 验证项目结构创建是否正确
- 验证构建脚本是否可执行
- 验证 CI/CD 工作流配置是否正确
- 验证 Rust 工具链是否正确安装
- 验证 Protocol Buffers 编译是否正常

### Technical Constraints
- **版本要求**: 遵循技术栈文档中定义的版本要求
- **平台兼容**: 确保 Android 和 Mac 平台兼容性
- **性能要求**: 构建时间优化，支持增量构建
- **安全要求**: .gitignore 包含敏感文件忽略规则

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | 初始故事创建 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
glm-4.6

### Debug Log References
无重大问题，实现过程顺利

### Completion Notes List
- 成功创建了完整的 monorepo 目录结构
- 配置了多语言构建系统（Android、macOS、Rust）
- 建立了 Protocol Buffers 跨平台通信协议
- 创建了完整的 CI/CD 工作流
- Rust 项目成功编译，所有依赖项正确配置

### File List
**新创建的文件：**
- src/platform/android/build.gradle.kts
- src/platform/android/app/build.gradle.kts
- src/platform/mac/Package.swift
- scripts/build-android.sh
- scripts/build-mac.sh
- scripts/build-rust.sh
- .github/workflows/ci.yml
- src/shared/protocol/device_discovery.proto
- src/shared/protocol/data_sync.proto
- src/shared/protocol/error_handling.proto
- src/shared/rust/Cargo.toml
- src/shared/rust/build.rs
- src/shared/rust/src/lib.rs
- src/shared/rust/src/device_discovery.rs
- src/shared/rust/src/data_sync.rs
- src/shared/rust/src/error_handling.rs
- src/shared/rust/src/utils.rs
- src/shared/rust/src/error.rs
- .env.example

**修改的文件：**
- README.md (完全重写，提供详细的项目信息)
- .gitignore (添加多语言项目忽略规则)

## QA Results
待 QA 代理填写