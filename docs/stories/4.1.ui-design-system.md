# 故事 4.1: UI设计系统

## 基本信息
- **故事编号**: 4.1
- **Epic**: Epic 4 - 用户体验与界面优化
- **故事名称**: UI设计系统
- **优先级**: 高
- **预计工期**: 4 天
- **负责人**: 待分配
- **创建时间**: 2025-10-17
- **更新时间**: 2025-10-17

## 用户故事
**作为** NearClip 用户，
**我希望** 应用具有统一、美观且易用的界面设计，
**以便** 我能够享受一致的视觉体验，轻松理解和使用各项功能。

## 验收标准

### AC 1: 统一设计语言
- **视觉一致性**: Android和macOS平台采用统一的设计语言和品牌标识
- **色彩系统**: 定义完整的色彩体系，包括主色调、辅助色、状态色等
- **字体系统**: 统一的字体选择、大小和层级规范
- **图标系统**: 一致的图标风格、尺寸和使用规范
- **间距规范**: 统一的边距、内边距和元素间距规范

### AC 2: 组件库设计
- **基础组件**: 按钮、输入框、选择器、开关等基础UI组件
- **复合组件**: 卡片、列表、表单、对话框等复合组件
- **反馈组件**: 加载器、提示框、通知、错误信息等反馈组件
- **导航组件**: 标签栏、侧边栏、面包屑等导航组件
- **布局组件**: 网格系统、容器、分割线等布局组件

### AC 3: 交互行为规范
- **微交互**: 按钮点击、切换开关、滑动操作等微交互效果
- **动画效果**: 页面转场、内容加载、状态变化等动画效果
- **手势支持**: 触摸手势、键盘快捷键等交互方式支持
- **响应反馈**: 即时视觉反馈、触觉反馈、音频反馈等
- **状态管理**: 加载状态、错误状态、空状态等不同状态的视觉表现

### AC 4: 跨平台适配
- **平台特性**: 适配Android和macOS的原生平台特性
- **屏幕适配**: 支持不同屏幕尺寸和分辨率的适配
- **主题切换**: 支持浅色、深色和系统跟随主题切换
- **无障碍访问**: 符合无障碍访问标准，支持屏幕阅读器
- **国际化**: 支持多语言界面和从右到左的语言布局

### AC 5: 设计文档与指南
- **设计规范文档**: 完整的设计规范文档和使用指南
- **组件文档**: 每个UI组件的使用说明和代码示例
- **设计资源**: 设计文件、图标、图片等资源的统一管理
- **开发指南**: 开发者如何正确使用设计系统的指南
- **维护流程**: 设计系统的更新、维护和版本控制流程

## 技术实现要点

### 1. 设计令牌系统
```typescript
// src/shared/design-tokens/index.ts

export const ColorTokens = {
  // 主色调
  primary: {
    50: '#f0f9ff',
    100: '#e0f2fe',
    200: '#bae6fd',
    300: '#7dd3fc',
    400: '#38bdf8',
    500: '#0ea5e9', // 主色
    600: '#0284c7',
    700: '#0369a1',
    800: '#075985',
    900: '#0c4a6e',
  },

  // 中性色
  neutral: {
    50: '#fafafa',
    100: '#f5f5f5',
    200: '#e5e5e5',
    300: '#d4d4d4',
    400: '#a3a3a3',
    500: '#737373',
    600: '#525252',
    700: '#404040',
    800: '#262626',
    900: '#171717',
  },

  // 语义色
  semantic: {
    success: '#10b981',
    warning: '#f59e0b',
    error: '#ef4444',
    info: '#3b82f6',
  },

  // 背景色
  background: {
    primary: '#ffffff',
    secondary: '#f8fafc',
    tertiary: '#f1f5f9',
  },

  // 文本色
  text: {
    primary: '#111827',
    secondary: '#6b7280',
    tertiary: '#9ca3af',
    inverse: '#ffffff',
  },
};

export const TypographyTokens = {
  fontFamily: {
    sans: ['Inter', 'system-ui', 'sans-serif'],
    mono: ['JetBrains Mono', 'Consolas', 'monospace'],
  },

  fontSize: {
    xs: '0.75rem',    // 12px
    sm: '0.875rem',   // 14px
    base: '1rem',     // 16px
    lg: '1.125rem',   // 18px
    xl: '1.25rem',    // 20px
    '2xl': '1.5rem',  // 24px
    '3xl': '1.875rem', // 30px
    '4xl': '2.25rem', // 36px
  },

  fontWeight: {
    light: 300,
    normal: 400,
    medium: 500,
    semibold: 600,
    bold: 700,
  },

  lineHeight: {
    tight: 1.25,
    normal: 1.5,
    relaxed: 1.75,
  },
};

export const SpacingTokens = {
  0: '0px',
  1: '0.25rem',   // 4px
  2: '0.5rem',    // 8px
  3: '0.75rem',   // 12px
  4: '1rem',      // 16px
  5: '1.25rem',   // 20px
  6: '1.5rem',    // 24px
  8: '2rem',      // 32px
  10: '2.5rem',   // 40px
  12: '3rem',     // 48px
  16: '4rem',     // 64px
  20: '5rem',     // 80px
};

export const BorderRadiusTokens = {
  none: '0px',
  sm: '0.125rem',   // 2px
  base: '0.25rem',  // 4px
  md: '0.375rem',   // 6px
  lg: '0.5rem',     // 8px
  xl: '0.75rem',    // 12px
  '2xl': '1rem',    // 16px
  full: '9999px',
};

export const ShadowTokens = {
  sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',
  base: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',
  md: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',
  lg: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',
  xl: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)',
};
```

### 2. Android Material Design 3 实现
```kotlin
// src/platform/android/app/src/main/java/com/nearclip/ui/theme/Color.kt
import androidx.compose.material3.darkColorScheme
import androidx.compose.material3.lightColorScheme
import androidx.compose.ui.graphics.Color

// Light Theme Colors
val NearClipLightColorScheme = lightColorScheme(
    primary = Color(0xFF0EA5E9),
    onPrimary = Color(0xFFFFFFFF),
    primaryContainer = Color(0xFFE0F2FE),
    onPrimaryContainer = Color(0xFF0C4A6E),

    secondary = Color(0xFF64748B),
    onSecondary = Color(0xFFFFFFFF),
    secondaryContainer = Color(0xFFF1F5F9),
    onSecondaryContainer = Color(0xFF1E293B),

    tertiary = Color(0xFF10B981),
    onTertiary = Color(0xFFFFFFFF),
    tertiaryContainer = Color(0xFFD1FAE5),
    onTertiaryContainer = Color(0xFF064E3B),

    background = Color(0xFFFAFAFA),
    onBackground = Color(0xFF111827),
    surface = Color(0xFFFFFFFF),
    onSurface = Color(0xFF111827),

    error = Color(0xFFEF4444),
    onError = Color(0xFFFFFFFF),
    errorContainer = Color(0xFFFEE2E2),
    onErrorContainer = Color(0xFF7F1D1D),

    outline = Color(0xFFD4D4D4),
    outlineVariant = Color(0xFFE5E5E5),
    scrim = Color(0xFF000000),
)

// Dark Theme Colors
val NearClipDarkColorScheme = darkColorScheme(
    primary = Color(0xFF38BDF8),
    onPrimary = Color(0xFF075985),
    primaryContainer = Color(0xFF075985),
    onPrimaryContainer = Color(0xFFE0F2FE),

    secondary = Color(0xFF94A3B8),
    onSecondary = Color(0xFF1E293B),
    secondaryContainer = Color(0xFF334155),
    onSecondaryContainer = Color(0xFFE2E8F0),

    tertiary = Color(0xFF34D399),
    onTertiary = Color(0xFF064E3B),
    tertiaryContainer = Color(0xFF064E3B),
    onTertiaryContainer = Color(0xFFD1FAE5),

    background = Color(0xFF111827),
    onBackground = Color(0xFFF9FAFB),
    surface = Color(0xFF1F2937),
    onSurface = Color(0xFFF9FAFB),

    error = Color(0xFFF87171),
    onError = Color(0xFF7F1D1D),
    errorContainer = Color(0xFF7F1D1D),
    onErrorContainer = Color(0xFFFEE2E2),

    outline = Color(0xFF4B5563),
    outlineVariant = Color(0xFF374151),
    scrim = Color(0xFF000000),
)

// src/platform/android/app/src/main/java/com/nearclip/ui/theme/Type.kt
import androidx.compose.material3.Typography
import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.sp

val NearClipTypography = Typography(
    displayLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 57.sp,
        lineHeight = 64.sp,
        letterSpacing = (-0.25).sp,
    ),
    displayMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 45.sp,
        lineHeight = 52.sp,
        letterSpacing = 0.sp,
    ),
    displaySmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 36.sp,
        lineHeight = 44.sp,
        letterSpacing = 0.sp,
    ),
    headlineLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 32.sp,
        lineHeight = 40.sp,
        letterSpacing = 0.sp,
    ),
    headlineMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 28.sp,
        lineHeight = 36.sp,
        letterSpacing = 0.sp,
    ),
    headlineSmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 24.sp,
        lineHeight = 32.sp,
        letterSpacing = 0.sp,
    ),
    titleLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 22.sp,
        lineHeight = 28.sp,
        letterSpacing = 0.sp,
    ),
    titleMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 16.sp,
        lineHeight = 24.sp,
        letterSpacing = 0.1.sp,
    ),
    titleSmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 14.sp,
        lineHeight = 20.sp,
        letterSpacing = 0.1.sp,
    ),
    bodyLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 16.sp,
        lineHeight = 24.sp,
        letterSpacing = 0.5.sp,
    ),
    bodyMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 14.sp,
        lineHeight = 20.sp,
        letterSpacing = 0.25.sp,
    ),
    bodySmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 12.sp,
        lineHeight = 16.sp,
        letterSpacing = 0.4.sp,
    ),
    labelLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 14.sp,
        lineHeight = 20.sp,
        letterSpacing = 0.1.sp,
    ),
    labelMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 12.sp,
        lineHeight = 16.sp,
        letterSpacing = 0.5.sp,
    ),
    labelSmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 11.sp,
        lineHeight = 16.sp,
        letterSpacing = 0.5.sp,
    ),
)

// src/platform/android/app/src/main/java/com/nearclip/ui/theme/Shape.kt
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Shapes
import androidx.compose.ui.unit.dp

val NearClipShapes = Shapes(
    extraSmall = RoundedCornerShape(4.dp),
    small = RoundedCornerShape(8.dp),
    medium = RoundedCornerShape(12.dp),
    large = RoundedCornerShape(16.dp),
    extraLarge = RoundedCornerShape(28.dp),
)
```

### 3. iOS SwiftUI 设计系统
```swift
// src/platform/mac/NearClip/DesignSystem/Color.swift
import SwiftUI

extension Color {
    // MARK: - Brand Colors
    static let nearclipPrimary = Color(red: 0.055, green: 0.647, blue: 0.914) // #0EA5E9
    static let nearclipPrimaryDark = Color(red: 0.219, green: 0.741, blue: 0.973) // #38BDF8

    // MARK: - Semantic Colors
    static let success = Color(red: 0.063, green: 0.725, blue: 0.506) // #10B981
    static let warning = Color(red: 0.961, green: 0.620, blue: 0.043) // #F59E0B
    static let error = Color(red: 0.937, green: 0.267, blue: 0.267) // #EF4444
    static let info = Color(red: 0.231, green: 0.51, blue: 0.967) // #3B82F6

    // MARK: - Neutral Colors
    static let neutral50 = Color(red: 0.980, green: 0.980, blue: 0.980) // #FAFAFA
    static let neutral100 = Color(red: 0.960, green: 0.960, blue: 0.960) // #F5F5F5
    static let neutral200 = Color(red: 0.898, green: 0.898, blue: 0.898) // #E5E5E5
    static let neutral300 = Color(red: 0.831, green: 0.831, blue: 0.831) // #D4D4D4
    static let neutral400 = Color(red: 0.639, green: 0.639, blue: 0.639) // #A3A3A3
    static let neutral500 = Color(red: 0.451, green: 0.451, blue: 0.451) // #737373
    static let neutral600 = Color(red: 0.322, green: 0.322, blue: 0.322) // #525252
    static let neutral700 = Color(red: 0.251, green: 0.251, blue: 0.251) // #404040
    static let neutral800 = Color(red: 0.149, green: 0.149, blue: 0.149) // #262626
    static let neutral900 = Color(red: 0.090, green: 0.090, blue: 0.090) // #171717
}

// MARK: - Color Scheme Protocol
protocol ColorScheme {
    var primary: Color { get }
    var onPrimary: Color { get }
    var background: Color { get }
    var onBackground: Color { get }
    var surface: Color { get }
    var onSurface: Color { get }
}

// MARK: - Light Color Scheme
struct NearClipLightColorScheme: ColorScheme {
    let primary = Color.nearclipPrimary
    let onPrimary = Color.white
    let background = Color.neutral50
    let onBackground = Color.neutral900
    let surface = Color.white
    let onSurface = Color.neutral900
}

// MARK: - Dark Color Scheme
struct NearClipDarkColorScheme: ColorScheme {
    let primary = Color.nearclipPrimaryDark
    let onPrimary = Color.neutral900
    let background = Color.neutral900
    let onBackground = Color.neutral50
    let surface = Color.neutral800
    let onSurface = Color.neutral50
}

// src/platform/mac/NearClip/DesignSystem/Typography.swift
import SwiftUI

extension Font {
    // MARK: - Display Fonts
    static let nearclipDisplayLarge = Font.system(size: 57, weight: .regular, design: .default)
    static let nearclipDisplayMedium = Font.system(size: 45, weight: .regular, design: .default)
    static let nearclipDisplaySmall = Font.system(size: 36, weight: .regular, design: .default)

    // MARK: - Headline Fonts
    static let nearclipHeadlineLarge = Font.system(size: 32, weight: .regular, design: .default)
    static let nearclipHeadlineMedium = Font.system(size: 28, weight: .regular, design: .default)
    static let nearclipHeadlineSmall = Font.system(size: 24, weight: .regular, design: .default)

    // MARK: - Title Fonts
    static let nearclipTitleLarge = Font.system(size: 22, weight: .medium, design: .default)
    static let nearclipTitleMedium = Font.system(size: 16, weight: .medium, design: .default)
    static let nearclipTitleSmall = Font.system(size: 14, weight: .medium, design: .default)

    // MARK: - Body Fonts
    static let nearclipBodyLarge = Font.system(size: 16, weight: .regular, design: .default)
    static let nearclipBodyMedium = Font.system(size: 14, weight: .regular, design: .default)
    static let nearclipBodySmall = Font.system(size: 12, weight: .regular, design: .default)

    // MARK: - Label Fonts
    static let nearclipLabelLarge = Font.system(size: 14, weight: .medium, design: .default)
    static let nearclipLabelMedium = Font.system(size: 12, weight: .medium, design: .default)
    static let nearclipLabelSmall = Font.system(size: 11, weight: .medium, design: .default)

    // MARK: - Monospace Fonts
    static let nearclipMono = Font.system(size: 14, weight: .regular, design: .monospaced)
}

// MARK: - Text Style Protocol
protocol TextStyle {
    var font: Font { get }
    var lineHeight: CGFloat { get }
    var letterSpacing: CGFloat { get }
}

// MARK: - Text Styles
struct NearClipTextStyles {
    static let displayLarge = TextStyle(font: .nearclipDisplayLarge, lineHeight: 64, letterSpacing: -0.25)
    static let headline = TextStyle(font: .nearclipHeadlineMedium, lineHeight: 36, letterSpacing: 0)
    static let title = TextStyle(font: .nearclipTitleMedium, lineHeight: 24, letterSpacing: 0.1)
    static let body = TextStyle(font: .nearclipBodyMedium, lineHeight: 20, letterSpacing: 0.25)
    static let caption = TextStyle(font: .nearclipBodySmall, lineHeight: 16, letterSpacing: 0.4)
}

// src/platform/mac/NearClip/DesignSystem/Spacing.swift
import SwiftUI

struct NearClipSpacing {
    // MARK: - Base Spacing
    static let xs: CGFloat = 4
    static let sm: CGFloat = 8
    static let md: CGFloat = 16
    static let lg: CGFloat = 24
    static let xl: CGFloat = 32
    static let xxl: CGFloat = 48
    static let xxxl: CGFloat = 64

    // MARK: - Component Specific
    static let buttonPaddingHorizontal: CGFloat = 16
    static let buttonPaddingVertical: CGFloat = 12
    static let cardPadding: CGFloat = 16
    static let sectionSpacing: CGFloat = 24
    static let itemSpacing: CGFloat = 12
}

// src/platform/mac/NearClip/DesignSystem/CornerRadius.swift
import SwiftUI

struct NearClipCornerRadius {
    static let none: CGFloat = 0
    static let sm: CGFloat = 4
    static let md: CGFloat = 8
    static let lg: CGFloat = 12
    static let xl: CGFloat = 16
    static let xxl: CGFloat = 24
    static let full: CGFloat = 9999
}

// MARK: - Corner Radius Extension
extension View {
    func cornerRadius(_ radius: CGFloat, corners: UIRectCorner) -> some View {
        clipShape(RoundedCorner(radius: radius, corners: corners))
    }
}

struct RoundedCorner: Shape {
    var radius: CGFloat = .infinity
    var corners: UIRectCorner = .allCorners

    func path(in rect: CGRect) -> Path {
        let path = UIBezierPath(
            roundedRect: rect,
            byRoundingCorners: corners,
            cornerRadii: CGSize(width: radius, height: radius)
        )
        return Path(path.cgPath)
    }
}
```

### 4. 基础组件库 - Android Jetpack Compose
```kotlin
// src/platform/android/app/src/main/java/com/nearclip/ui/components/Button.kt
import androidx.compose.animation.core.animateFloatAsState
import androidx.compose.animation.core.tween
import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.interaction.MutableInteractionSource
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.alpha
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.scale
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp

// Button Variants
enum class NearClipButtonVariant {
    Primary,
    Secondary,
    Outline,
    Ghost,
    Destructive
}

// Button Sizes
enum class NearClipButtonSize {
    Small,
    Medium,
    Large
}

@Composable
fun NearClipButton(
    text: String,
    onClick: () -> Unit,
    modifier: Modifier = Modifier,
    variant: NearClipButtonVariant = NearClipButtonVariant.Primary,
    size: NearClipButtonSize = NearClipButtonSize.Medium,
    enabled: Boolean = true,
    loading: Boolean = false,
    leadingIcon: @Composable (() -> Unit)? = null,
    trailingIcon: @Composable (() -> Unit)? = null,
) {
    val colors = MaterialTheme.colorScheme
    val typography = MaterialTheme.typography

    val backgroundColor by animateColorAsState(
        targetValue = when (variant) {
            NearClipButtonVariant.Primary -> if (enabled) colors.primary else colors.onSurface.copy(alpha = 0.12f)
            NearClipButtonVariant.Secondary -> if (enabled) colors.secondary else colors.onSurface.copy(alpha = 0.12f)
            NearClipButtonVariant.Outline -> Color.Transparent
            NearClipButtonVariant.Ghost -> Color.Transparent
            NearClipButtonVariant.Destructive -> if (enabled) colors.error else colors.onSurface.copy(alpha = 0.12f)
        },
        animationSpec = tween(200)
    )

    val contentColor by animateColorAsState(
        targetValue = when (variant) {
            NearClipButtonVariant.Primary -> colors.onPrimary
            NearClipButtonVariant.Secondary -> colors.onSecondary
            NearClipButtonVariant.Outline -> if (enabled) colors.primary else colors.onSurface.copy(alpha = 0.38f)
            NearClipButtonVariant.Ghost -> if (enabled) colors.primary else colors.onSurface.copy(alpha = 0.38f)
            NearClipButtonVariant.Destructive -> colors.onError
        },
        animationSpec = tween(200)
    )

    val borderWidth = if (variant == NearClipButtonVariant.Outline) 1.dp else 0.dp
    val borderColor = if (enabled) colors.primary else colors.onSurface.copy(alpha = 0.12f)

    val (horizontalPadding, verticalPadding) = when (size) {
        NearClipButtonSize.Small -> 12.dp to 8.dp
        NearClipButtonSize.Medium -> 16.dp to 12.dp
        NearClipButtonSize.Large -> 24.dp to 16.dp
    }

    val textStyle = when (size) {
        NearClipButtonSize.Small -> typography.labelMedium
        NearClipButtonSize.Medium -> typography.labelLarge
        NearClipButtonSize.Large -> typography.titleSmall
    }

    val scale by animateFloatAsState(
        targetValue = if (loading) 0.95f else 1f,
        animationSpec = tween(150)
    )

    Box(
        modifier = modifier
            .scale(scale)
            .clip(RoundedCornerShape(12.dp))
            .background(backgroundColor)
            .border(
                width = borderWidth,
                color = borderColor,
                shape = RoundedCornerShape(12.dp)
            )
            .clickable(
                enabled = enabled && !loading,
                onClick = onClick,
                indication = null,
                interactionSource = remember { MutableInteractionSource() }
            )
            .padding(horizontal = horizontalPadding, vertical = verticalPadding),
        contentAlignment = Alignment.Center
    ) {
        if (loading) {
            CircularProgressIndicator(
                modifier = Modifier.size(16.dp),
                strokeWidth = 2.dp,
                color = contentColor
            )
        } else {
            Row(
                horizontalArrangement = Arrangement.Center,
                verticalAlignment = Alignment.CenterVertically,
                horizontalGravity = Alignment.CenterHorizontally
            ) {
                leadingIcon?.invoke()
                if (leadingIcon != null) {
                    Spacer(modifier = Modifier.width(8.dp))
                }

                Text(
                    text = text,
                    style = textStyle,
                    color = contentColor,
                    fontWeight = FontWeight.Medium
                )

                if (trailingIcon != null) {
                    Spacer(modifier = Modifier.width(8.dp))
                }
                trailingIcon?.invoke()
            }
        }
    }
}

// src/platform/android/app/src/main/java/com/nearclip/ui/components/Card.kt
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp

@Composable
fun NearClipCard(
    modifier: Modifier = Modifier,
    onClick: (() -> Unit)? = null,
    enabled: Boolean = true,
    elevation: Int = 1,
    backgroundColor: Color = MaterialTheme.colorScheme.surface,
    content: @Composable ColumnScope.() -> Unit,
) {
    val colors = MaterialTheme.colorScheme

    Card(
        modifier = modifier
            .fillMaxWidth()
            .let { if (onClick != null) it.clickable(enabled = enabled) { onClick() } else it },
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = backgroundColor
        ),
        elevation = CardDefaults.cardElevation(
            defaultElevation = elevation.dp
        )
    ) {
        Column(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            content = content
        )
    }
}

@Composable
fun NearClipInfoCard(
    title: String,
    description: String,
    modifier: Modifier = Modifier,
    icon: @Composable (() -> Unit)? = null,
    action: @Composable (() -> Unit)? = null,
) {
    NearClipCard(
        modifier = modifier,
        elevation = 0,
        backgroundColor = MaterialTheme.colorScheme.surfaceVariant
    ) {
        Row(
            modifier = Modifier.fillMaxWidth(),
            verticalAlignment = Alignment.CenterVertically
        ) {
            if (icon != null) {
                Box(
                    modifier = Modifier
                        .size(40.dp)
                        .background(
                            MaterialTheme.colorScheme.primary.copy(alpha = 0.1f),
                            RoundedCornerShape(12.dp)
                        ),
                    contentAlignment = Alignment.Center
                ) {
                    icon()
                }
                Spacer(modifier = Modifier.width(12.dp))
            }

            Column(
                modifier = Modifier.weight(1f)
            ) {
                Text(
                    text = title,
                    style = MaterialTheme.typography.titleMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.height(4.dp))
                Text(
                    text = description,
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.7f)
                )
            }

            if (action != null) {
                Spacer(modifier = Modifier.width(12.dp))
                action()
            }
        }
    }
}
```

### 5. 基础组件库 - SwiftUI
```swift
// src/platform/mac/NearClip/DesignSystem/Components/Button.swift
import SwiftUI

// Button Variants
enum NearClipButtonVariant {
    case primary
    case secondary
    case outline
    case ghost
    case destructive
}

// Button Sizes
enum NearClipButtonSize {
    case small
    case medium
    case large
}

struct NearClipButton: View {
    let title: String
    let action: () -> Void
    var variant: NearClipButtonVariant = .primary
    var size: NearClipButtonSize = .medium
    var enabled: Bool = true
    var loading: Bool = false
    var leadingIcon: (() -> AnyView)? = nil
    var trailingIcon: (() -> AnyView)? = nil

    @State private var isPressed = false

    private var backgroundColor: Color {
        switch variant {
        case .primary:
            return enabled ? Color.nearclipPrimary : Color.neutral300
        case .secondary:
            return enabled ? Color.neutral500 : Color.neutral300
        case .outline, .ghost:
            return Color.clear
        case .destructive:
            return enabled ? Color.error : Color.neutral300
        }
    }

    private var foregroundColor: Color {
        switch variant {
        case .primary, .destructive:
            return enabled ? Color.white : Color.neutral500
        case .secondary:
            return enabled ? Color.white : Color.neutral500
        case .outline, .ghost:
            return enabled ? Color.nearclipPrimary : Color.neutral500
        }
    }

    private var borderColor: Color {
        switch variant {
        case .outline:
            return enabled ? Color.nearclipPrimary : Color.neutral300
        default:
            return Color.clear
        }
    }

    private var padding: (horizontal: CGFloat, vertical: CGFloat) {
        switch size {
        case .small:
            return (12, 8)
        case .medium:
            return (16, 12)
        case .large:
            return (24, 16)
        }
    }

    private var font: Font {
        switch size {
        case .small:
            return .nearclipLabelMedium
        case .medium:
            return .nearclipLabelLarge
        case .large:
            return .nearclipTitleSmall
        }
    }

    var body: some View {
        Button(action: action) {
            HStack(spacing: 8) {
                if let leadingIcon = leadingIcon {
                    leadingIcon()
                }

                if loading {
                    ProgressView()
                        .scaleEffect(0.8)
                        .progressViewStyle(CircularProgressViewStyle(tint: foregroundColor))
                } else {
                    Text(title)
                        .font(font)
                        .fontWeight(.medium)
                        .foregroundColor(foregroundColor)
                }

                if let trailingIcon = trailingIcon {
                    trailingIcon()
                }
            }
            .padding(.horizontal, padding.horizontal)
            .padding(.vertical, padding.vertical)
            .background(
                RoundedRectangle(cornerRadius: 12)
                    .fill(backgroundColor)
                    .overlay(
                        RoundedRectangle(cornerRadius: 12)
                            .stroke(borderColor, lineWidth: variant == .outline ? 1 : 0)
                    )
            )
            .scaleEffect(isPressed ? 0.95 : 1.0)
            .animation(.easeInOut(duration: 0.15), value: isPressed)
        }
        .disabled(!enabled || loading)
        .buttonStyle(PlainButtonStyle())
        .onLongPressGesture(
            minimumDuration: 0,
            maximumDistance: .infinity,
            pressing: { pressing in
                isPressed = pressing
            },
            perform: {}
        )
    }
}

// src/platform/mac/NearClip/DesignSystem/Components/Card.swift
import SwiftUI

struct NearClipCard<Content: View>: View {
    let content: Content
    var action: (() -> Void)? = nil
    var backgroundColor: Color = Color.white
    var cornerRadius: CGFloat = NearClipCornerRadius.lg
    var shadowRadius: CGFloat = 4

    init(
        backgroundColor: Color = Color.white,
        cornerRadius: CGFloat = NearClipCornerRadius.lg,
        shadowRadius: CGFloat = 4,
        action: (() -> Void)? = nil,
        @ViewBuilder content: () -> Content
    ) {
        self.backgroundColor = backgroundColor
        self.cornerRadius = cornerRadius
        self.shadowRadius = shadowRadius
        self.action = action
        self.content = content()
    }

    var body: some View {
        Group {
            if let action = action {
                Button(action: action) {
                    cardContent
                }
                .buttonStyle(PlainButtonStyle())
            } else {
                cardContent
            }
        }
    }

    private var cardContent: some View {
        VStack(spacing: 0) {
            content
        }
        .padding(NearClipSpacing.md)
        .background(
            RoundedRectangle(cornerRadius: cornerRadius)
                .fill(backgroundColor)
                .shadow(
                    color: Color.black.opacity(0.1),
                    radius: shadowRadius,
                    x: 0,
                    y: 2
                )
        )
    }
}

struct NearClipInfoCard: View {
    let title: String
    let description: String
    let icon: (() -> AnyView)? = nil
    let action: (() -> AnyView)? = nil

    var body: some View {
        NearClipCard(
            backgroundColor: Color.neutral50,
            action: action != nil ? action!() : nil
        ) {
            HStack(alignment: .center, spacing: NearClipSpacing.md) {
                if let icon = icon {
                    icon()
                        .frame(width: 40, height: 40)
                        .background(
                            Color.nearclipPrimary.opacity(0.1),
                            in: RoundedRectangle(cornerRadius: NearClipCornerRadius.md)
                        )
                }

                VStack(alignment: .leading, spacing: NearClipSpacing.xs) {
                    Text(title)
                        .font(.nearclipTitleMedium)
                        .foregroundColor(Color.nearclipPrimary)

                    Text(description)
                        .font(.nearclipBodyMedium)
                        .foregroundColor(Color.neutral600)
                        .lineLimit(2)
                }

                Spacer()

                if let action = action {
                    action()
                }
            }
        }
    }
}

// src/platform/mac/NearClip/DesignSystem/Components/InputField.swift
import SwiftUI

struct NearClipInputField: View {
    let title: String
    @Binding var text: String
    let placeholder: String
    let icon: (() -> AnyView)? = nil
    let isSecure: Bool
    let keyboardType: UIKeyboardType
    let onSubmit: (() -> Void)?

    @State private var isFocused = false
    @State private var showPassword = false

    init(
        title: String,
        text: Binding<String>,
        placeholder: String = "",
        icon: (() -> AnyView)? = nil,
        isSecure: Bool = false,
        keyboardType: UIKeyboardType = .default,
        onSubmit: (() -> Void)? = nil
    ) {
        self.title = title
        self._text = text
        self.placeholder = placeholder
        self.icon = icon
        self.isSecure = isSecure
        self.keyboardType = keyboardType
        self.onSubmit = onSubmit
    }

    var body: some View {
        VStack(alignment: .leading, spacing: NearClipSpacing.xs) {
            Text(title)
                .font(.nearclipLabelMedium)
                .foregroundColor(Color.nearclipPrimary)

            HStack(spacing: NearClipSpacing.sm) {
                if let icon = icon {
                    icon()
                        .foregroundColor(Color.neutral400)
                }

                Group {
                    if isSecure && !showPassword {
                        SecureField(placeholder, text: $text)
                    } else {
                        TextField(placeholder, text: $text)
                    }
                }
                .keyboardType(keyboardType)
                .onSubmit {
                    onSubmit?()
                }
                .textFieldStyle(PlainTextFieldStyle())
                .font(.nearclipBodyMedium)
                .foregroundColor(Color.neutral900)

                if isSecure {
                    Button(action: {
                        showPassword.toggle()
                    }) {
                        Image(systemName: showPassword ? "eye.slash" : "eye")
                            .foregroundColor(Color.neutral400)
                    }
                    .buttonStyle(PlainButtonStyle())
                }
            }
            .padding(.horizontal, NearClipSpacing.md)
            .padding(.vertical, NearClipSpacing.sm)
            .background(
                RoundedRectangle(cornerRadius: NearClipCornerRadius.md)
                    .fill(Color.white)
                    .overlay(
                        RoundedRectangle(cornerRadius: NearClipCornerRadius.md)
                            .stroke(
                                isFocused ? Color.nearclipPrimary : Color.neutral300,
                                lineWidth: 1
                            )
                    )
            )
            .onTapGesture {
                // Focus the text field
            }
        }
        .animation(.easeInOut(duration: 0.2), value: isFocused)
    }
}
```

### 6. 主题管理系统
```kotlin
// src/platform/android/app/src/main/java/com/nearclip/ui/theme/Theme.kt
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.darkColorScheme
import androidx.compose.material3.lightColorScheme
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.platform.LocalContext
import androidx.hilt.navigation.compose.hiltViewModel

enum class ThemeMode {
    LIGHT, DARK, SYSTEM
}

@Composable
fun NearClipTheme(
    themeMode: ThemeMode = ThemeMode.SYSTEM,
    content: @Composable () -> Unit
) {
    val systemInDarkTheme = isSystemInDarkTheme()
    val isDarkTheme = when (themeMode) {
        ThemeMode.LIGHT -> false
        ThemeMode.DARK -> true
        ThemeMode.SYSTEM -> systemInDarkTheme
    }

    val colorScheme = if (isDarkTheme) {
        NearClipDarkColorScheme
    } else {
        NearClipLightColorScheme
    }

    MaterialTheme(
        colorScheme = colorScheme,
        typography = NearClipTypography,
        shapes = NearClipShapes,
        content = content
    )
}

@Composable
fun NearClipAppTheme(
    themeViewModel: ThemeViewModel = hiltViewModel(),
    content: @Composable () -> Unit
) {
    val themeMode by themeViewModel.themeMode.collectAsState()

    NearClipTheme(
        themeMode = themeMode,
        content = content
    )
}
```

```swift
// src/platform/mac/NearClip/DesignSystem/Theme.swift
import SwiftUI

enum ThemeMode: String, CaseIterable {
    case light = "light"
    case dark = "dark"
    case system = "system"
}

class ThemeManager: ObservableObject {
    @Published var currentTheme: ThemeMode = .system {
        didSet {
            UserDefaults.standard.set(currentTheme.rawValue, forKey: "selectedTheme")
        }
    }

    init() {
        if let savedTheme = UserDefaults.standard.string(forKey: "selectedTheme"),
           let theme = ThemeMode(rawValue: savedTheme) {
            currentTheme = theme
        }
    }

    var isDarkMode: Bool {
        switch currentTheme {
        case .light:
            return false
        case .dark:
            return true
        case .system:
            return NSApp.effectiveAppearance.bestMatch(from: [.darkAqua, .aqua]) == .darkAqua
        }
    }

    var colorScheme: ColorScheme {
        isDarkMode ? .dark : .light
    }
}

struct NearClipTheme<Content: View>: View {
    @StateObject private var themeManager = ThemeManager()
    let content: Content

    init(@ViewBuilder content: () -> Content) {
        self.content = content()
    }

    var body: some View {
        content
            .preferredColorScheme(themeManager.colorScheme)
            .environmentObject(themeManager)
    }
}

// MARK: - Environment Keys
struct ThemeKey: EnvironmentKey {
    static let defaultValue = ThemeManager()
}

extension EnvironmentValues {
    var themeManager: ThemeManager {
        get { self[ThemeKey.self] }
        set { self[ThemeKey.self] = newValue }
    }
}
```

## 测试用例

### UI组件测试
```kotlin
// src/platform/android/app/src/test/java/com/nearclip/ui/components/ButtonTest.kt
import androidx.compose.ui.test.*
import androidx.compose.ui.test.junit4.createComposeRule
import org.junit.Rule
import org.junit.Test

class NearClipButtonTest {

    @get:Rule
    val composeTestRule = createComposeRule()

    @Test
    fun nearClipButton_displaysCorrectText() {
        composeTestRule.setContent {
            NearClipButton(
                text = "Test Button",
                onClick = {}
            )
        }

        composeTestRule
            .onNodeWithText("Test Button")
            .assertIsDisplayed()
    }

    @Test
    fun nearClipButton_handlesClick() {
        var clicked = false

        composeTestRule.setContent {
            NearClipButton(
                text = "Click Me",
                onClick = { clicked = true }
            )
        }

        composeTestRule
            .onNodeWithText("Click Me")
            .performClick()

        assert(clicked)
    }

    @Test
    fun nearClipButton_disabledState() {
        composeTestRule.setContent {
            NearClipButton(
                text = "Disabled Button",
                onClick = {},
                enabled = false
            )
        }

        composeTestRule
            .onNodeWithText("Disabled Button")
            .assertIsNotEnabled()
    }
}
```

### SwiftUI组件测试
```swift
// src/platform/mac/NearClip/DesignSystem/Tests/ButtonTests.swift
import XCTest
import SwiftUI
import ViewInspector

final class NearClipButtonTests: XCTestCase {

    func testButtonDisplaysText() throws {
        var button = NearClipButton(title: "Test Button") {}
        let text = try button.inspect().text().string()
        XCTAssertEqual(text, "Test Button")
    }

    func testButtonClickAction() throws {
        var actionCalled = false
        var button = NearClipButton(title: "Click Me") {
            actionCalled = true
        }

        try button.inspect().button().tap()
        XCTAssertTrue(actionCalled)
    }

    func testButtonDisabledState() throws {
        var button = NearClipButton(
            title: "Disabled",
            action: {},
            enabled: false
        )

        let isEnabled = try button.inspect().button().isEnabled()
        XCTAssertFalse(isEnabled)
    }
}
```

## 部署要求

### 设计工具
- Figma: 用于UI设计和协作
- Zeplin: 用于设计规范交付
- Storybook: 用于组件展示和文档

### 开发依赖
```kotlin
// Android build.gradle
dependencies {
    implementation "androidx.compose.ui:ui:$compose_version"
    implementation "androidx.compose.ui:ui-tooling-preview:$compose_version"
    implementation "androidx.compose.material3:material3:$material3_version"
    implementation "androidx.compose.material:material-icons-extended:$compose_version"
}
```

```swift
// macOS Package.swift
dependencies: [
    .package(url: "https://github.com/apple/swiftui", from: "1.0.0"),
]
```

## 验收测试计划

### 设计一致性测试
1. **视觉回归测试**: 自动化UI截图对比
2. **组件测试**: 验证每个组件的正确渲染
3. **主题测试**: 验证主题切换的正确性
4. **响应式测试**: 验证不同屏幕尺寸的适配

### 可用性测试
1. **用户测试**: 邀请用户进行实际使用测试
2. **无障碍测试**: 验证无障碍访问功能
3. **性能测试**: 验证UI渲染性能
4. **兼容性测试**: 验证跨平台兼容性

## 风险与缓解

### 设计风险
- **设计不一致**: 不同开发者实现可能不一致
  - 缓解: 详细的组件文档，代码审查，自动化测试
- **性能问题**: 复杂UI可能影响性能
  - 缓解: 性能监控，优化策略，延迟加载

### 维护风险
- **维护成本高**: 设计系统需要持续维护
  - 缓解: 自动化工具，文档完善，团队培训
- **版本兼容性**: 新版本可能破坏现有组件
  - 缓解: 版本控制，向后兼容，迁移指南

## 完成标准
- [ ] 完整的设计令牌系统建立
- [ ] Android和macOS组件库完成
- [ ] 主题管理系统实现
- [ ] 设计文档和使用指南完成
- [ ] 所有组件的单元测试通过
- [ ] 跨平台设计一致性验证通过
- [ ] 无障碍访问标准符合
- [ ] 国际化支持实现
- [ ] 性能优化达到预期
- [ ] 设计系统集成到项目中