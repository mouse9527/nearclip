# NearClip 手动测试指南

**版本**: 1.0
**更新时间**: 2026-01-14
**适用范围**: macOS ↔ Android 跨平台剪贴板同步

---

## 📋 目录

1. [环境准备](#1-环境准备)
2. [基础功能测试](#2-基础功能测试)
3. [错误场景测试](#3-错误场景测试)
4. [性能测试](#4-性能测试)
5. [测试清单](#5-测试清单)
6. [已知问题和限制](#6-已知问题和限制)

---

## 1. 环境准备

### 1.1 设备要求

#### macOS 设备
- **系统版本**: macOS 12.0 或更高
- **硬件**: 支持 BLE 4.0+
- **权限**:
  - ✅ 蓝牙权限
  - ✅ 本地网络权限
  - ✅ 辅助功能权限(剪贴板访问)

#### Android 设备
- **系统版本**: Android 8.0 (API 26) 或更高
- **硬件**: 支持 BLE 4.0+
- **权限**:
  - ✅ 蓝牙权限
  - ✅ 位置权限 (BLE 扫描需要)
  - ✅ 相机权限 (QR 扫描需要)
  - ✅ 通知权限

### 1.2 网络配置

- **WiFi**: 两台设备连接到同一 WiFi 网络 (可选,用于 WiFi 连接)
- **蓝牙**: 两台设备的蓝牙均已开启
- **防火墙**: macOS 防火墙允许 NearClip 接收连接

### 1.3 应用安装

#### macOS
```bash
cd macos/NearClip
swift build -c release
open .build/release/NearClip
```

#### Android
```bash
cd android
./gradlew assembleDebug
adb install app/build/outputs/apk/debug/app-debug.apk
```

### 1.4 初始设置

1. **首次启动**
   - macOS: 允许所有权限请求
   - Android: 允许所有权限请求

2. **检查服务状态**
   - macOS: 菜单栏应显示 NearClip 图标
   - Android: 通知栏应显示服务运行状态

---

## 2. 基础功能测试

### Test 2.1: QR 码配对 (macOS → Android)

**前置条件**:
- 两台设备都已安装并运行 NearClip
- 两台设备都未配对任何设备

**测试步骤**:

1. **macOS 端操作**:
   ```
   1. 点击菜单栏 NearClip 图标
   2. 选择 "配对新设备"
   3. 点击 "生成 QR 码"
   4. QR 码应显示在窗口中
   ```

2. **Android 端操作**:
   ```
   1. 打开 NearClip 应用
   2. 点击 "扫描 QR 码"
   3. 允许相机权限
   4. 将相机对准 macOS 显示的 QR 码
   5. 扫描成功后,应显示 "正在连接..."
   ```

3. **验证配对结果**:
   - macOS: 配对设备列表中应显示 Android 设备名称
   - Android: 配对设备列表中应显示 macOS 设备名称
   - 两端设备状态应为 "已连接" (绿色)

**预期结果**:
- ✅ QR 码生成成功
- ✅ QR 码扫描成功
- ✅ 设备配对成功
- ✅ 连接状态显示正确

**常见问题**:
- ❌ QR 码扫描失败 → 确保 QR 码清晰,光线充足
- ❌ 配对超时 → 检查两台设备是否在同一网络
- ❌ 连接失败 → 检查蓝牙和网络权限

---

### Test 2.2: QR 码配对 (Android → macOS)

**前置条件**:
- 同 Test 2.1

**测试步骤**:

1. **Android 端操作**:
   ```
   1. 打开 NearClip 应用
   2. 点击 "配对新设备"
   3. 点击 "生成 QR 码"
   4. QR 码应显示在屏幕上
   ```

2. **macOS 端操作**:
   ```
   1. 点击菜单栏 NearClip 图标
   2. 选择 "配对新设备"
   3. 点击 "扫描 QR 码"
   4. 允许相机权限
   5. 将相机对准 Android 显示的 QR 码
   6. 扫描成功后,应显示配对进度
   ```

3. **验证配对结果**:
   - 同 Test 2.1

**预期结果**:
- ✅ 双向配对都能成功
- ✅ 配对信息一致

---

### Test 2.3: BLE 设备发现

**前置条件**:
- 两台设备已配对

**测试步骤**:

1. **断开当前连接**:
   ```
   1. macOS: 点击设备 → "断开连接"
   2. Android: 点击设备 → "断开连接"
   3. 两端状态应变为 "未连接"
   ```

2. **启动设备发现**:
   ```
   1. macOS: 点击 "发现设备"
   2. Android: 点击 "发现设备"
   3. 应显示 "正在扫描..."
   ```

3. **验证设备列表**:
   - macOS: 可用设备列表应显示 Android 设备
   - Android: 可用设备列表应显示 macOS 设备
   - 设备信号强度 (RSSI) 应显示

**预期结果**:
- ✅ BLE 扫描成功启动
- ✅ 30 秒内发现对方设备
- ✅ 设备信息准确 (名称、信号强度)

**常见问题**:
- ❌ 未发现设备 → 确保蓝牙已开启
- ❌ 发现速度慢 → 正常,BLE 扫描需要时间
- ❌ 信号弱 → 将两台设备靠近

---

### Test 2.4: 设备连接 (BLE)

**前置条件**:
- 两台设备已配对
- 设备处于未连接状态

**测试步骤**:

1. **macOS 发起连接**:
   ```
   1. 点击已配对设备
   2. 点击 "连接"
   3. 应显示 "正在连接..."
   4. 连接成功后状态变为 "已连接"
   ```

2. **验证连接状态**:
   - macOS: 设备状态 = "已连接" (绿色)
   - Android: 设备状态 = "已连接" (绿色)
   - 通知: 两端都应显示连接成功通知

3. **验证连接方式**:
   - 查看连接详情
   - 应显示 "传输方式: BLE"

**预期结果**:
- ✅ 连接在 10 秒内成功
- ✅ 两端状态同步
- ✅ 连接稳定,无断开

**常见问题**:
- ❌ 连接超时 → 重启蓝牙后重试
- ❌ 连接后立即断开 → 检查蓝牙稳定性

---

### Test 2.5: 设备连接 (WiFi)

**前置条件**:
- 两台设备已配对
- 两台设备在同一 WiFi 网络

**测试步骤**:

1. **macOS 发起 WiFi 连接**:
   ```
   1. 点击已配对设备
   2. 点击 "连接" (优先使用 WiFi)
   3. 应显示 "正在通过 WiFi 连接..."
   4. 连接成功后状态变为 "已连接"
   ```

2. **验证连接方式**:
   - 查看连接详情
   - 应显示 "传输方式: WiFi"
   - IP 地址应显示

3. **性能对比**:
   - WiFi 连接速度应快于 BLE
   - 传输带宽更大

**预期结果**:
- ✅ WiFi 连接优先于 BLE
- ✅ 连接速度更快
- ✅ 支持更大文件

**常见问题**:
- ❌ WiFi 连接失败,退回 BLE → 正常行为
- ❌ 无法通过 WiFi 连接 → 检查防火墙设置

---

### Test 2.6: 剪贴板同步 - 纯文本

**前置条件**:
- 两台设备已连接 (BLE 或 WiFi)

**测试步骤**:

1. **macOS → Android 同步**:
   ```
   1. macOS: 复制一段文本到剪贴板
      例如: "Hello from macOS!"
   2. Android: 等待 2-3 秒
   3. Android: 粘贴剪贴板内容
   4. 应粘贴出 macOS 复制的文本
   ```

2. **Android → macOS 同步**:
   ```
   1. Android: 复制一段文本到剪贴板
      例如: "Hello from Android!"
   2. macOS: 等待 2-3 秒
   3. macOS: 粘贴剪贴板内容
   4. 应粘贴出 Android 复制的文本
   ```

3. **验证同步指示**:
   - macOS: 菜单栏图标应闪烁
   - Android: 通知栏应显示同步提示
   - 两端都应记录同步历史

**预期结果**:
- ✅ 文本同步成功
- ✅ 内容完全一致
- ✅ 同步延迟 < 3 秒
- ✅ 支持 Unicode 字符

**测试数据**:
- 短文本: "Hello"
- 中文: "你好世界"
- Emoji: "😀🎉🚀"
- 长文本: 1000+ 字符
- 特殊字符: `\n\t<>&"`

---

### Test 2.7: 剪贴板同步 - 图片

**前置条件**:
- 两台设备已连接

**测试步骤**:

1. **macOS → Android (小图片)**:
   ```
   1. macOS: 复制一张小图片 (< 1MB)
   2. Android: 等待 5-10 秒
   3. Android: 粘贴到支持图片的应用 (如备忘录)
   4. 应显示 macOS 复制的图片
   ```

2. **验证图片质量**:
   - 分辨率保持不变
   - 无明显压缩失真
   - 格式正确 (PNG/JPEG)

3. **测试不同大小**:
   - 小图片: < 100KB
   - 中图片: 100KB - 1MB
   - 大图片: 1MB - 5MB

**预期结果**:
- ✅ 小图片 (< 1MB) 同步成功
- ✅ 图片质量无损
- ✅ 同步时间合理

**已知限制**:
- ⚠️ 非常大的图片 (> 5MB) 可能失败
- ⚠️ BLE 传输大图片较慢,建议使用 WiFi

---

### Test 2.8: 剪贴板同步 - 文件

**前置条件**:
- 两台设备已连接 (WiFi 推荐)

**测试步骤**:

1. **macOS → Android (小文件)**:
   ```
   1. macOS: 复制一个小文件到剪贴板 (< 1MB)
   2. Android: 等待传输完成
   3. Android: 文件应保存到下载目录
   4. 验证文件完整性 (MD5/SHA256)
   ```

2. **测试不同文件类型**:
   - 文本文件: .txt, .md
   - 文档: .pdf, .docx
   - 图片: .png, .jpg
   - 压缩包: .zip

**预期结果**:
- ✅ 小文件 (< 1MB) 同步成功
- ✅ 文件内容完整
- ✅ 文件名保持

**已知限制**:
- ⚠️ 大文件 (> 10MB) 不支持
- ⚠️ 某些特殊文件类型可能不支持

---

### Test 2.9: 设备断开

**前置条件**:
- 两台设备已连接

**测试步骤**:

1. **主动断开 (macOS)**:
   ```
   1. macOS: 点击设备 → "断开连接"
   2. 应显示 "断开中..."
   3. 状态变为 "未连接"
   ```

2. **验证断开状态**:
   - macOS: 设备状态 = "未连接"
   - Android: 设备状态 = "未连接"
   - 通知: 两端显示断开提示

3. **主动断开 (Android)**:
   - 同上,从 Android 端断开

**预期结果**:
- ✅ 断开操作立即生效
- ✅ 两端状态同步
- ✅ 断开后可以重新连接

---

### Test 2.10: 设备取消配对

**前置条件**:
- 两台设备已配对

**测试步骤**:

1. **macOS 取消配对**:
   ```
   1. macOS: 点击设备 → "取消配对"
   2. 确认操作
   3. 设备应从配对列表中移除
   ```

2. **验证取消配对**:
   - macOS: 配对列表不再显示该设备
   - Android: 配对列表不再显示 macOS 设备
   - 存储: 设备密钥已从 Keychain/EncryptedPrefs 删除

3. **重新配对测试**:
   - 应可以重新扫描 QR 码配对
   - 配对后生成新的设备密钥

**预期结果**:
- ✅ 取消配对成功
- ✅ 两端数据同步删除
- ✅ 可以重新配对

---

## 3. 错误场景测试

### Test 3.1: 网络中断处理

**测试步骤**:

1. **模拟 WiFi 断开**:
   ```
   1. 建立 WiFi 连接
   2. 禁用 WiFi
   3. 观察应用行为
   ```

2. **预期行为**:
   - ✅ 应用检测到 WiFi 断开
   - ✅ 自动尝试 BLE 连接
   - ✅ 显示连接方式切换提示

3. **恢复测试**:
   ```
   1. 重新启用 WiFi
   2. 应自动切换回 WiFi 连接
   ```

**预期结果**:
- ✅ WiFi → BLE 无缝切换
- ✅ 剪贴板同步不中断
- ✅ 用户体验平滑

---

### Test 3.2: BLE 断开重连

**测试步骤**:

1. **模拟 BLE 断开**:
   ```
   1. 建立 BLE 连接
   2. 关闭一台设备的蓝牙
   3. 观察另一台设备反应
   ```

2. **预期行为**:
   - ✅ 检测到连接断开 (< 30 秒)
   - ✅ 状态变为 "连接中..."
   - ✅ 尝试自动重连

3. **重连测试**:
   ```
   1. 重新启用蓝牙
   2. 应在 1 分钟内自动重连
   ```

**预期结果**:
- ✅ 自动重连成功
- ✅ 重连最多尝试 5 次
- ✅ 失败后可手动重连

---

### Test 3.3: 无效 QR 码处理

**测试步骤**:

1. **扫描无效 QR 码**:
   ```
   1. 生成一个随机 QR 码 (非 NearClip 格式)
   2. 尝试扫描
   ```

2. **预期行为**:
   - ✅ 显示 "无效的 QR 码" 错误
   - ✅ 不尝试配对
   - ✅ 可以重新扫描

3. **测试数据**:
   - 空 QR 码
   - 普通文本 QR 码
   - JSON 格式错误
   - 缺少必需字段

**预期结果**:
- ✅ 错误提示清晰
- ✅ 不会崩溃
- ✅ 可以重试

---

### Test 3.4: 权限拒绝处理

**测试步骤**:

1. **拒绝蓝牙权限**:
   ```
   1. 系统设置中禁用蓝牙权限
   2. 尝试启动 BLE 扫描
   ```

2. **预期行为**:
   - ✅ 显示权限错误提示
   - ✅ 引导用户到设置页面
   - ✅ 禁用 BLE 相关功能

3. **测试其他权限**:
   - 相机权限 (QR 扫描)
   - 位置权限 (BLE 扫描)
   - 通知权限

**预期结果**:
- ✅ 错误提示友好
- ✅ 提供解决方案
- ✅ 不影响其他功能

---

## 4. 性能测试

### Test 4.1: 大文件同步

**测试数据**:
- 1MB 文本文件
- 5MB 图片
- 10MB PDF

**测试步骤**:

1. **通过 WiFi 传输**:
   ```
   1. 建立 WiFi 连接
   2. 复制大文件
   3. 记录传输时间
   ```

2. **通过 BLE 传输**:
   ```
   1. 建立 BLE 连接
   2. 复制大文件
   3. 记录传输时间
   ```

**性能基准**:
- WiFi (1MB): < 5 秒
- WiFi (5MB): < 20 秒
- BLE (1MB): < 30 秒
- BLE (5MB): < 2 分钟

**预期结果**:
- ✅ 大文件通过 WiFi 传输成功
- ✅ BLE 传输较慢但可用
- ✅ 进度提示清晰

---

### Test 4.2: 多设备并发

**前置条件**:
- 1 台 macOS + 2 台 Android 设备

**测试步骤**:

1. **配对多台设备**:
   ```
   1. macOS 与 Android 1 配对
   2. macOS 与 Android 2 配对
   3. 验证两个配对都成功
   ```

2. **同时连接**:
   ```
   1. 同时连接两台 Android 设备
   2. 验证连接状态
   ```

3. **并发同步**:
   ```
   1. macOS 复制文本
   2. 验证两台 Android 都收到
   ```

**预期结果**:
- ✅ 支持多设备配对
- ✅ 支持同时连接 2+ 设备
- ✅ 剪贴板广播到所有设备

---

### Test 4.3: 长时间运行稳定性

**测试步骤**:

1. **24 小时运行测试**:
   ```
   1. 建立连接
   2. 让应用运行 24 小时
   3. 每小时测试一次剪贴板同步
   ```

2. **监控指标**:
   - 内存使用
   - CPU 使用
   - 连接稳定性
   - 同步成功率

**预期结果**:
- ✅ 内存无明显泄漏
- ✅ CPU 空闲时 < 5%
- ✅ 连接不断开
- ✅ 同步成功率 > 95%

---

## 5. 测试清单

### 5.1 快速检查清单

在每次发布前,完成以下快速检查:

| # | 测试项 | macOS | Android | 备注 |
|---|--------|-------|---------|------|
| 1 | QR 码配对 | ☐ | ☐ | 双向测试 |
| 2 | BLE 设备发现 | ☐ | ☐ | 30秒内 |
| 3 | 设备连接 | ☐ | ☐ | BLE + WiFi |
| 4 | 文本同步 | ☐ | ☐ | 双向测试 |
| 5 | 图片同步 | ☐ | ☐ | < 1MB |
| 6 | 设备断开 | ☐ | ☐ | 主动断开 |
| 7 | 取消配对 | ☐ | ☐ | 数据清除 |
| 8 | 网络切换 | ☐ | ☐ | WiFi ↔ BLE |
| 9 | 错误处理 | ☐ | ☐ | 无效QR码 |
| 10 | 权限处理 | ☐ | ☐ | 拒绝/授予 |

### 5.2 完整测试清单

| 分类 | 测试项 | 优先级 | 状态 | 执行人 | 日期 |
|------|--------|--------|------|--------|------|
| 基础 | Test 2.1 - QR 配对(M→A) | P0 | ☐ | | |
| 基础 | Test 2.2 - QR 配对(A→M) | P0 | ☐ | | |
| 基础 | Test 2.3 - BLE 发现 | P0 | ☐ | | |
| 基础 | Test 2.4 - BLE 连接 | P0 | ☐ | | |
| 基础 | Test 2.5 - WiFi 连接 | P1 | ☐ | | |
| 基础 | Test 2.6 - 文本同步 | P0 | ☐ | | |
| 基础 | Test 2.7 - 图片同步 | P1 | ☐ | | |
| 基础 | Test 2.8 - 文件同步 | P2 | ☐ | | |
| 基础 | Test 2.9 - 设备断开 | P0 | ☐ | | |
| 基础 | Test 2.10 - 取消配对 | P1 | ☐ | | |
| 错误 | Test 3.1 - 网络中断 | P1 | ☐ | | |
| 错误 | Test 3.2 - BLE 重连 | P1 | ☐ | | |
| 错误 | Test 3.3 - 无效QR码 | P1 | ☐ | | |
| 错误 | Test 3.4 - 权限拒绝 | P2 | ☐ | | |
| 性能 | Test 4.1 - 大文件 | P2 | ☐ | | |
| 性能 | Test 4.2 - 多设备 | P2 | ☐ | | |
| 性能 | Test 4.3 - 稳定性 | P2 | ☐ | | |

**优先级说明**:
- **P0**: 必须通过,核心功能
- **P1**: 重要功能,应该通过
- **P2**: 可选功能,建议测试

---

## 6. 已知问题和限制

### 6.1 当前版本限制

#### 文件大小限制
- **最大文件**: 10MB
- **推荐大小**: < 1MB
- **原因**: BLE MTU 限制,WiFi 传输稳定性

#### 同步延迟
- **WiFi**: 1-3 秒
- **BLE**: 2-5 秒
- **原因**: 协议开销,加密处理

#### 设备数量限制
- **最大配对设备**: 10 台
- **最大同时连接**: 5 台
- **原因**: 系统资源限制

### 6.2 已知问题

#### Issue #1: macOS BLE 扫描偶尔失败
**症状**: 扫描 30 秒后未发现设备
**解决**: 重启蓝牙或重启应用
**优先级**: P2 (低频发生)

#### Issue #2: 大图片同步卡顿
**症状**: > 3MB 图片同步时 UI 卡顿
**解决**: 使用 WiFi 连接
**优先级**: P1 (影响体验)

#### Issue #3: Android BLE 权限提示混乱
**症状**: Android 12+ 权限提示不清晰
**解决**: 已在设置页面添加说明
**优先级**: P2 (已有workaround)

### 6.3 平台差异

| 功能 | macOS | Android | 备注 |
|------|-------|---------|------|
| QR 码生成 | ✅ | ✅ | |
| QR 码扫描 | ✅ | ✅ | |
| BLE 广播 | ✅ | ✅ | |
| BLE 扫描 | ✅ | ✅ | 需要位置权限 |
| WiFi 发现 | ✅ | ✅ | mDNS |
| 剪贴板监听 | ✅ | ⚠️ | Android 需轮询 |
| 后台运行 | ✅ | ⚠️ | Android 可能被杀 |
| 文件传输 | ✅ | ✅ | |

---

## 7. 测试报告模板

### 7.1 测试执行记录

```markdown
# NearClip 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**测试设备**:
- macOS: [设备型号] - macOS [版本]
- Android: [设备型号] - Android [版本]
**应用版本**: v[版本号]

## 测试结果汇总

- 总测试用例: [数量]
- 通过: [数量]
- 失败: [数量]
- 跳过: [数量]
- 通过率: [百分比]%

## 详细结果

| 测试项 | 结果 | 备注 |
|--------|------|------|
| Test 2.1 | ✅ | |
| Test 2.2 | ❌ | QR码扫描失败,光线问题 |
| ... | | |

## 发现的问题

1. **[问题标题]**
   - 严重程度: [P0/P1/P2]
   - 复现步骤: [详细步骤]
   - 预期行为: [描述]
   - 实际行为: [描述]
   - 截图/日志: [链接]

## 建议

[测试建议和改进意见]

## 签名

测试人: ___________
日期: ___________
```

---

## 8. 附录

### 8.1 测试数据准备

**文本测试数据**:
```
# 短文本
Hello, NearClip!

# 中文
你好,世界!这是中文测试。

# Emoji
😀 🎉 🚀 ❤️ ✅

# 长文本 (1000 字符)
Lorem ipsum dolor sit amet...

# 特殊字符
<html>\n\t\r&nbsp;&amp;

# JSON
{"name": "test", "value": 123}

# 代码
def hello():
    print("Hello, world!")
```

**图片测试数据**:
- 小图片: 100x100 PNG (< 10KB)
- 中图片: 1024x768 JPEG (~ 500KB)
- 大图片: 2048x1536 PNG (~ 2MB)

### 8.2 日志收集

**macOS**:
```bash
# 查看应用日志
log show --predicate 'process == "NearClip"' --last 1h

# 导出日志
log show --predicate 'process == "NearClip"' --last 1d > nearclip.log
```

**Android**:
```bash
# 查看应用日志
adb logcat | grep NearClip

# 保存日志
adb logcat > nearclip-android.log
```

### 8.3 性能监控

**macOS Activity Monitor**:
- 监控内存使用
- 监控 CPU 使用
- 监控网络流量

**Android Developer Options**:
- 启用 "显示 CPU 使用情况"
- 启用 "显示 GPU 渲染模式分析"
- 使用 Android Studio Profiler

---

**文档版本**: 1.0
**最后更新**: 2026-01-14
**维护者**: NearClip Team
**反馈**: [GitHub Issues](https://github.com/yourusername/nearclip/issues)
