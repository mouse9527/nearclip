# Task 0504: 实现连接池管理

## 任务描述

实现设备连接池管理，优化多设备连接的资源使用。

## 正交性分析

- **连接管理**: 连接生命周期管理
- **资源优化**: 连接资源复用
- **负载均衡**: 连接负载分布
- **监控统计**: 连接状态监控

## 技术实现

### 核心组件
```rust
// rust-core/network/connection_pool.rs
pub struct DeviceConnectionPool {
    connections: HashMap<String, PooledConnection>,
    config: PoolConfig,
    metrics: PoolMetrics,
    cleanup_task: JoinHandle<()>,
}

pub struct PooledConnection {
    pub device_id: String,
    pub connection: DeviceConnection,
    pub last_used: SystemTime,
    pub use_count: u32,
    pub is_active: bool,
    pub created_at: SystemTime,
}

pub struct PoolConfig {
    pub max_connections: usize,
    pub max_idle_time: Duration,
    pub connection_timeout: Duration,
    pub health_check_interval: Duration,
    pub enable_connection_reuse: bool,
}

pub struct PoolMetrics {
    pub total_connections: u32,
    pub active_connections: u32,
    pub idle_connections: u32,
    pub total_requests: u64,
    pub cache_hits: u64,
    pub cache_misses: u64,
    pub average_wait_time: Duration,
}
```

### 接口设计
```rust
impl DeviceConnectionPool {
    pub fn new(config: PoolConfig) -> Self;
    pub async fn get_connection(&mut self, device_id: &str) -> Result<&PooledConnection, PoolError>;
    pub async fn create_connection(&mut self, device_id: &str, address: SocketAddr) -> Result<(), PoolError>;
    pub fn release_connection(&mut self, device_id: &str);
    pub async fn close_connection(&mut self, device_id: &str) -> Result<(), PoolError>;
    pub fn get_connection_status(&self, device_id: &str) -> Option<&PooledConnection>;
    pub fn get_pool_metrics(&self) -> &PoolMetrics;
    pub async fn health_check(&mut self) -> Vec<PoolHealthResult>;
    pub fn cleanup_idle_connections(&mut self) -> u32;
    pub fn resize_pool(&mut self, new_max_connections: usize);
}
```

## 验收标准

- [ ] 连接管理高效
- [ ] 资源复用优化
- [ ] 负载分布合理
- [ ] 监控统计完整
- [ ] 性能优化
- [ ] 错误处理完善