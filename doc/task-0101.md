# Task 0101: 实现mDNS设备发现

## 任务描述

实现基于mDNS协议的设备发现功能，让应用能够自动发现局域网内运行的其他设备。

## 正交性分析

- **独立功能**: 不依赖其他模块，可独立测试
- **清晰边界**: 只负责设备发现，不处理连接或配对
- **单一职责**: 专注于mDNS服务发现
- **可复用**: 发现的设备信息可被其他模块使用

## 技术实现

### 依赖项
- `mdns-sd`: mDNS服务发现
- `tokio`: 异步运行时
- `log`: 日志记录

### 核心组件
```rust
// rust-core/discovery/mdns_discovery.rs
pub struct MdnsDiscovery {
    service_browser: ServiceBrowser,
    discovered_devices: HashMap<String, DeviceInfo>,
    discovery_callback: Option<Box<dyn Fn(DeviceInfo) + Send + Sync>>,
}

pub struct DeviceInfo {
    pub id: String,
    pub name: String,
    pub ip_address: String,
    pub port: u16,
    pub service_type: String,
    pub last_seen: SystemTime,
}
```

### 接口设计
```rust
impl MdnsDiscovery {
    pub fn new() -> Result<Self, DiscoveryError>;
    pub fn start_discovery(&mut self, service_type: &str) -> Result<(), DiscoveryError>;
    pub fn stop_discovery(&mut self) -> Result<(), DiscoveryError>;
    pub fn get_discovered_devices(&self) -> Vec<DeviceInfo>;
    pub fn set_callback<F>(&mut self, callback: F) where F: Fn(DeviceInfo) + Send + Sync + 'static;
}
```

### 实现步骤
1. 初始化mDNS服务浏览器
2. 注册服务类型监听
3. 处理设备发现事件
4. 维护设备列表和最后发现时间
5. 提供设备信息查询接口

## 测试策略

- 单元测试：mDNS事件处理逻辑
- 集成测试：实际网络环境中的设备发现
- 模拟测试：使用模拟的mDNS响应

## 验收标准

- [ ] 能够发现指定服务类型的设备
- [ ] 设备信息格式正确
- [ ] 支持开始/停止发现
- [ ] 设备列表实时更新
- [ ] 内存使用合理（无内存泄漏）
- [ ] 错误处理完善