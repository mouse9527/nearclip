# 跨设备剪贴板同步工具 - 开发计划

## 项目概述

一个高性能、低资源占用的跨设备剪贴板同步工具，使用Rust实现核心逻辑，原生语言开发UI。

## 技术架构

### 核心架构
- **Rust核心库**: 设备发现、加密、混合传输管理
- **Android UI**: Kotlin/Jetpack Compose + Rust FFI
- **iOS UI**: SwiftUI + Rust FFI  
- **桌面UI**: Tauri + Rust (或平台原生)

### 传输层架构
- **统一抽象**: Transport trait (支持WiFi/BLE扩展)
- **智能选择**: 基于上下文的传输方式选择
- **无缝切换**: 网络环境变化时自动切换
- **协议桥接**: WiFi与BLE设备间的通信桥接

### 通信协议
- **设备发现**: mDNS (WiFi) + BLE广播
- **数据传输**: TCP/IP (WiFi) + BLE GATT
- **安全加密**: ECDH密钥交换 + AES-256-GCM
- **配对方式**: 二维码 + PIN码

## INVEST User Stories

### Story 1: 设备发现与连接 (混合传输架构)
**目标**: 用户能够在各种网络环境下发现设备并建立连接，系统自动选择最佳传输方式

**核心特性**: 
- 统一的设备抽象（用户只看到设备，不关心传输方式）
- 混合发现机制（mDNS + BLE）
- 智能传输选择（WiFi/BLE自动切换）
- 无缝传输切换（网络变化时用户无感知）

### Story 2: 安全配对与密钥交换
**目标**: 用户能够安全地配对设备并交换加密密钥

### Story 3: 手动文本传输
**目标**: 用户能够手动发送文本内容到配对设备

### Story 4: 自动剪贴板同步
**目标**: 用户能够自动同步剪贴板内容到配对设备

### Story 5: 设备管理与重连 (多端适配)
**目标**: 用户能够管理已配对设备并在网络恢复时自动重连

**跨平台特性**:
- Android: 后台服务、省电模式、Doze模式适配
- iOS: Background App Refresh、应用挂起状态处理
- 桌面端: 系统启动、休眠唤醒、托盘图标集成

## 任务列表总览

### Story 1: 设备发现与连接 (13个任务)
**基础发现任务**:
- [task-0101.md](./task-0101.md) - 实现mDNS设备发现
- [task-0102.md](./task-0102.md) - 实现设备信息广播
- [task-0103.md](./task-0103.md) - 实现设备列表管理（统一抽象）

**传输层抽象**:
- [task-0106.md](./task-0106.md) - 实现传输层抽象接口
- [task-0107.md](./task-0107.md) - 实现WiFi传输适配器
- [task-0108.md](./task-0108.md) - 实现BLE传输适配器

**混合传输机制**:
- [task-0109.md](./task-0109.md) - 实现智能传输选择器
- [task-0110.md](./task-0110.md) - 实现传输自动切换机制
- [task-0111.md](./task-0111.md) - 实现BLE设备发现
- [task-0112.md](./task-0112.md) - 实现协议桥接机制

**状态与监控**:
- [task-0105.md](./task-0105.md) - 实现设备状态追踪
- [task-0113.md](./task-0113.md) - 实现上下文感知监控
- [task-0104.md](./task-0104.md) - 实现TCP连接管理

### Story 2: 安全配对与密钥交换 (5个任务)
- [task-0201.md](./task-0201.md) - 实现ECDH密钥交换
- [task-0202.md](./task-0202.md) - 实现AES-256-GCM加密
- [task-0203.md](./task-0203.md) - 实现二维码配对
- [task-0204.md](./task-0204.md) - 实现PIN码配对
- [task-0205.md](./task-0205.md) - 实现密钥持久化存储

### Story 3: 手动文本传输 (5个任务)
- [task-0301.md](./task-0301.md) - 实现文本输入界面
- [task-0302.md](./task-0302.md) - 实现设备选择器
- [task-0303.md](./task-0303.md) - 实现文本传输队列
- [task-0304.md](./task-0304.md) - 实现传输进度追踪
- [task-0305.md](./task-0305.md) - 实现传输历史记录

### Story 4: 自动剪贴板同步 (5个任务)
- [task-0401.md](./task-0401.md) - 实现剪贴板监控
- [task-0402.md](./task-0402.md) - 实现内容过滤
- [task-0403.md](./task-0403.md) - 实现同步策略
- [task-0404.md](./task-0404.md) - 实现队列管理
- [task-0405.md](./task-0405.md) - 实现冲突解决

### Story 5: 设备管理与重连 (5个任务)
- [task-0501.md](./task-0501.md) - 实现设备信息存储
- [task-0502.md](./task-0502.md) - 实现设备状态监控
- [task-0503.md](./task-0503.md) - 实现智能重连
- [task-0504.md](./task-0504.md) - 实现连接池管理
- [task-0505.md](./task-0505.md) - 实现备份恢复

## 开发优先级和里程碑

### 里程碑 1: 基础架构 (高优先级)
- **目标**: 建立混合传输架构，支持基本的设备发现和连接
- **Story**: Story 1 (所有传输层任务)
- **预估时间**: 3-4周

### 里程碑 2: 安全基础 (高优先级)  
- **目标**: 建立端到端加密的配对机制
- **Story**: Story 2
- **预估时间**: 2-3周

### 里程碑 3: 核心功能 (中优先级)
- **目标**: 实现手动文本传输和基础设备管理
- **Story**: Story 3 + Story 5 (核心功能)
- **预估时间**: 2-3周

### 里程碑 4: 增强功能 (低优先级)
- **目标**: 实现自动剪贴板同步
- **Story**: Story 4
- **预估时间**: 2周

### 里程碑 5: 多端适配 (中优先级)
- **目标**: 完成各平台的特定适配和优化
- **范围**: Story 5 (平台特定任务) + 各平台UI适配
- **预估时间**: 2-3周

## 技术架构亮点

- **统一抽象**: 用户层面只看到设备，传输方式完全透明
- **智能选择**: 基于网络环境、信号质量、功耗等因素自动选择最佳传输
- **无缝切换**: 网络环境变化时传输方式自动切换，用户无感知
- **跨平台**: 支持Android、iOS、桌面端的统一体验
- **高性能**: Rust核心库确保低资源占用和高性能
- **安全**: 端到端加密，支持多种配对方式

每个任务的具体内容请查看对应的 `task-*.md` 文件。

## 资源考虑和性能目标

### 资源占用目标
- **内存占用**: Rust核心库 < 50MB运行时内存
- **CPU使用**: 后台运行 < 5% CPU占用
- **电池影响**: BLE模式下 < 2%电池消耗/小时
- **网络流量**: 心跳包 < 1KB/分钟，设备发现 < 10KB/次

### 跨平台兼容性
- **Android**: API 21+ (Android 5.0+)
- **iOS**: iOS 12.0+
- **桌面**: macOS 10.14+, Windows 10+, Ubuntu 18.04+

### 开发和维护
- **Rust核心库**: 确保低资源占用和内存安全
- **模块化设计**: 便于维护和功能扩展
- **原生UI**: 提供最佳用户体验和系统集成
- **CI/CD**: 自动化测试和多平台构建