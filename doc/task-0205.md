# Task 0205: 实现密钥持久化存储

## 任务描述

实现配对密钥的安全持久化存储功能。

## 正交性分析

- **安全存储**: 专注于密钥的安全存储
- **数据管理**: 密钥的增删改查
- **加密保护**: 存储数据的额外保护
- **备份恢复**: 密钥数据的备份和恢复

## 技术实现

### 核心组件
```rust
// rust-core/crypto/key_storage.rs
pub struct KeyStorage {
    encrypted_db: SqliteConnection,
    master_key: [u8; 32],
    config: StorageConfig,
}

pub struct StoredKey {
    pub device_id: String,
    pub key_type: KeyType,
    pub key_data: Vec<u8>,
    pub created_at: SystemTime,
    pub expires_at: Option<SystemTime>,
    pub metadata: HashMap<String, String>,
}

pub enum KeyType {
    SharedSecret,
    PublicKey,
    DeviceCertificate,
}
```

### 接口设计
```rust
impl KeyStorage {
    pub fn new(master_key: &[u8; 32], db_path: &str) -> Result<Self, StorageError>;
    pub fn store_key(&mut self, key: StoredKey) -> Result<(), StorageError>;
    pub fn retrieve_key(&self, device_id: &str, key_type: KeyType) -> Option<StoredKey>;
    pub fn delete_key(&mut self, device_id: &str, key_type: KeyType) -> Result<(), StorageError>;
    pub fn list_keys(&self) -> Vec<StoredKey>;
    pub fn backup_keys(&self, backup_path: &str) -> Result<(), StorageError>;
    pub fn restore_keys(&mut self, backup_path: &str) -> Result<(), StorageError>;
}
```

## 验收标准

- [ ] 密钥安全存储
- [ ] 数据完整性保护
- [ ] 访问控制
- [ ] 备份恢复功能
- [ ] 性能优化
- [ ] 跨平台兼容