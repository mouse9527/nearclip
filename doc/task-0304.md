# Task 0304: 实现传输进度追踪

## 任务描述

实现传输进度追踪功能，提供实时的传输状态反馈。

## 正交性分析

- **进度计算**: 传输进度计算
- **状态更新**: 实时状态更新
- **事件通知**: 进度变化事件
- **持久化**: 进度信息存储

## 技术实现

### 核心组件
```rust
// rust-core/transfer/progress_tracker.rs
pub struct ProgressTracker {
    active_transfers: HashMap<String, TransferProgress>,
    event_emitter: EventEmitter<ProgressEvent>,
    config: ProgressConfig,
}

pub struct TransferProgress {
    pub task_id: String,
    pub total_bytes: u64,
    pub transferred_bytes: u64,
    pub current_device: String,
    pub devices_completed: Vec<String>,
    pub devices_failed: Vec<String>,
    pub start_time: SystemTime,
    pub estimated_completion: Option<SystemTime>,
    pub speed_bps: f64,
}

pub struct ProgressEvent {
    pub task_id: String,
    pub progress: f32,
    pub status: TransferStatus,
    pub message: Option<String>,
    pub timestamp: SystemTime,
}
```

### 接口设计
```rust
impl ProgressTracker {
    pub fn new(config: ProgressConfig) -> Self;
    pub fn start_tracking(&mut self, task_id: String, total_bytes: u64, device_count: usize);
    pub fn update_progress(&mut self, task_id: &str, transferred_bytes: u64, device_id: &str);
    pub fn complete_device(&mut self, task_id: &str, device_id: &str);
    pub fn fail_device(&mut self, task_id: &str, device_id: &str, error: &str);
    pub fn complete_transfer(&mut self, task_id: &str);
    pub fn get_progress(&self, task_id: &str) -> Option<&TransferProgress>;
    pub fn subscribe_to_progress(&mut self, callback: Box<dyn Fn(ProgressEvent) + Send + Sync>);
}
```

## 验收标准

- [ ] 进度计算准确
- [ ] 实时状态更新
- [ ] 事件系统完整
- [ ] 性能优化
- [ ] 错误处理完善
- [ ] UI集成友好