# Task 0102: 实现设备信息广播

## 任务描述

实现设备信息广播功能，让其他设备能够发现本设备。

## 正交性分析

- **独立功能**: 与设备发现分离，只负责广播
- **清晰边界**: 只处理广播，不处理发现逻辑
- **单一职责**: 专注于UDP广播设备信息
- **可配置**: 广播内容和频率可配置

## 技术实现

### 依赖项
- `tokio`: 异步网络IO
- `serde`: 序列化/反序列化
- `serde_json`: JSON格式支持

### 核心组件
```rust
// rust-core/discovery/broadcaster.rs
pub struct DeviceBroadcaster {
    socket: UdpSocket,
    broadcast_interval: Duration,
    device_info: DeviceInfo,
    is_running: bool,
}

#[derive(Serialize, Deserialize)]
pub struct BroadcastMessage {
    pub device_id: String,
    pub device_name: String,
    pub service_port: u16,
    pub protocol_version: String,
    pub timestamp: u64,
}
```

### 接口设计
```rust
impl DeviceBroadcaster {
    pub fn new(device_info: DeviceInfo) -> Result<Self, BroadcastError>;
    pub fn start_broadcasting(&mut self) -> Result<(), BroadcastError>;
    pub fn stop_broadcasting(&mut self) -> Result<(), BroadcastError>;
    pub fn update_device_info(&mut self, info: DeviceInfo) -> Result<(), BroadcastError>;
    pub fn set_broadcast_interval(&mut self, interval: Duration);
}
```

### 实现步骤
1. 创建UDP广播socket
2. 配置广播地址和端口
3. 实现定时广播逻辑
4. 序列化设备信息为JSON
5. 处理广播错误和重试

## 测试策略

- 单元测试：广播消息格式验证
- 网络测试：实际UDP广播功能
- 性能测试：广播频率和资源占用

## 验收标准

- [ ] 定期广播设备信息
- [ ] 广播消息格式正确
- [ ] 支持动态更新设备信息
- [ ] 网络错误处理完善
- [ ] 广播频率可配置
- [ ] 支持多个网络接口